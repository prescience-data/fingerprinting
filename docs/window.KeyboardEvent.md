---
title: window.KeyboardEvent
layout: default
---
# window.KeyboardEvent
## Purpose
Represents an event that occurs when the user interacts with the keyboard. It is dispatched for `keydown`, `keyup`, and the legacy `keypress` events, providing details about the key pressed.

## Fingerprinting Usage
`KeyboardEvent` is a cornerstone of behavioral biometrics for bot detection. Analysis focuses on the timing, sequence, and properties of events, as bots struggle to replicate the nuanced and irregular patterns of human typing.

1.  **`isTrusted` Flag**: This is the most critical property. Events initiated by a real user action have `isTrusted` set to `true`. Events created and dispatched by a script (e.g., `element.dispatchEvent(new KeyboardEvent(...))`) have `isTrusted` set to `false`. This is a primary, high-confidence signal for detecting programmatic event simulation. Sophisticated bots using protocols like CDP (Chrome DevTools Protocol) can bypass this, but it catches simpler automation.

2.  **Typing Cadence (Behavioral)**: The timing between key events is a high-entropy behavioral signal.
    *   **Dwell Time**: The duration between a `keydown` and its corresponding `keyup` event for the same key.
    *   **Flight Time**: The duration between the `keyup` of one key and the `keydown` of the next.
    *   Human typing has a unique, irregular rhythm. Bots often exhibit unnaturally perfect timing (e.g., 0ms dwell time, constant flight time) or are too fast for human capability. Collecting these timings over a session builds a behavioral fingerprint.

3.  **Event Property Consistency**: Bots often fail to construct `KeyboardEvent` objects with complete or logical properties.
    *   **`key` vs. `code`**: `key` represents the character produced ('a' or 'A'), while `code` represents the physical key pressed ('KeyA'). A script might send a `keydown` event for an uppercase 'A' without an accompanying `shiftKey: true` property or a preceding `CapsLock` event, which is impossible for a human typist.
    *   **`repeat` Property**: When a user holds down a key, a series of `keydown` events are fired where the `repeat` property is `true` (except for the first one). Bots may instead fire multiple distinct `keydown` events with `repeat: false`, which is anomalous.

4.  **Composition Events**: For users of Input Method Editors (IMEs) (e.g., for Chinese, Japanese, Korean), typing involves `compositionstart`, `compositionupdate`, and `compositionend` events. A browser profile claiming a CJK locale/language that *never* produces composition events when filling text fields is highly suspicious. Bots rarely simulate this complex interaction.

5.  **Event-Focus Correlation**: Keyboard events should only be dispatched to the currently focused element (`document.activeElement`). Bots may erroneously dispatch events to elements that are not in focus, which is a strong indicator of automation.

## Sample Code
This snippet demonstrates capturing typing cadence (dwell and flight times) and checking the `isTrusted` flag.

```javascript
const keyAnalytics = {
  lastKeyDownTime: 0,
  keyPressTimings: new Map(), // Using a Map to track multiple key presses
  typingCadence: [],
};

// Listen for a key being pressed down
document.addEventListener('keydown', (e) => {
  // A primary check: events generated by scripts will have isTrusted = false.
  if (!e.isTrusted) {
    console.warn('Untrusted keydown event detected!', e.key);
    return;
  }

  // Ignore repeated events from holding a key down for this analysis
  if (e.repeat) return;

  const now = performance.now();
  
  // Record flight time: time between the last key up and this key down
  if (keyAnalytics.lastKeyDownTime > 0) {
    const flightTime = now - keyAnalytics.lastKeyDownTime;
    keyAnalytics.typingCadence.push({ type: 'flight', value: flightTime, key: e.key });
  }
  
  keyAnalytics.keyPressTimings.set(e.code, now);
  keyAnalytics.lastKeyDownTime = now;
}, true); // Use capture phase to get event first

// Listen for a key being released
document.addEventListener('keyup', (e) => {
  if (!e.isTrusted) return;

  const now = performance.now();
  const keyDownTime = keyAnalytics.keyPressTimings.get(e.code);

  if (keyDownTime) {
    // Record dwell time: how long the key was held down
    const dwellTime = now - keyDownTime;
    keyAnalytics.typingCadence.push({ type: 'dwell', value: dwellTime, key: e.key });
    keyAnalytics.keyPressTimings.delete(e.code);
  }
}, true);

// After some user input, `keyAnalytics.typingCadence` will contain a behavioral
// profile that can be analyzed for bot-like patterns.
// e.g., check for dwell times of 0ms or perfectly consistent flight times.
```